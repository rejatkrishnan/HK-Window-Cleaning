<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard | HK Window Pros</title>
<style>
  body, html {
    height: 100%;
    margin: 0;
    font-family: 'Roboto', sans-serif;
    background-color: #f0f6ff;
    display: flex;
    flex-direction: column;
  }
  header {
    background: linear-gradient(90deg, #007BFF, #0056b3);
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
  }
  header h1 {
    margin: 0;
    font-size: 1.8rem;
  }
  button.logout-btn {
    background: #e03c3c;
    border: none;
    color: white;
    padding: 0.5rem 1.2rem;
    border-radius: 5px;
    font-weight: 700;
    cursor: pointer;
  }
  button.logout-btn:hover {
    background: #a32a2a;
  }
  main {
    flex: 1;
    padding: 1rem 2rem;
    max-width: 1000px;
    margin: auto;
    box-sizing: border-box;
  }
  .tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .tab-button {
    flex: 1;
    padding: 0.7rem;
    background: #ddd;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    color: #003f7f;
    transition: background-color 0.3s;
  }
  .tab-button.active {
    background: #1a40af;
    color: white;
  }
  .job-list {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(26,64,175,0.15);
    padding: 1rem;
    max-height: 400px;
    overflow-y: auto;
  }
  .job-item {
    border-bottom: 1px solid #ccc;
    padding: 0.8rem 0;
    cursor: pointer;
  }
  .job-item:last-child {
    border-bottom: none;
  }
  .job-item:hover {
    background-color: #e6f0ff;
  }
  .job-title {
    font-weight: 700;
    color: #0056b3;
  }
  .job-info {
    font-size: 0.9rem;
    color: #444;
  }
  /* Add job form styles */
  .add-job-container {
    margin-top: 2rem;
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(26,64,175,0.15);
  }
  .add-job-container h2 {
    margin-top: 0;
    color: #1a40af;
    text-align: center;
  }
  .add-job-container label {
    display: block;
    margin-top: 1rem;
    font-weight: 700;
  }
  .add-job-container input, .add-job-container select {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.3rem;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  .add-job-container button {
    margin-top: 1rem;
    background: #1a40af;
    color: white;
    font-weight: 700;
    border: none;
    padding: 0.7rem;
    width: 100%;
    border-radius: 6px;
    cursor: pointer;
  }
  .add-job-container button:hover {
    background: #15327a;
  }
  /* Edit modal styles */
  #editModal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }
  #editModal .modal-content {
    background: white;
    border-radius: 10px;
    padding: 1.5rem 2rem;
    width: 400px;
    max-width: 90%;
  }
  #editModal h3 {
    margin-top: 0;
    color: #1a40af;
  }
  #editModal label {
    margin-top: 1rem;
    display: block;
    font-weight: 700;
  }
  #editModal input, #editModal select {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.3rem;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  #editModal button {
    margin-top: 1rem;
    background: #1a40af;
    color: white;
    font-weight: 700;
    border: none;
    padding: 0.7rem;
    width: 100%;
    border-radius: 6px;
    cursor: pointer;
  }
  #editModal button:hover {
    background: #15327a;
  }
  #editModal .close-btn {
    background: #ccc;
    color: #333;
    margin-top: 0.5rem;
  }
  #editModal .close-btn:hover {
    background: #999;
  }
</style>
</head>
<body>

<header>
  <h1>Dashboard | HK Window Pros</h1>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</header>

<main>
  <div class="tabs">
    <button class="tab-button active" data-tab="pending">Pending Jobs</button>
    <button class="tab-button" data-tab="inprogress">In Progress</button>
    <button class="tab-button" data-tab="completed">Completed</button>
  </div>

  <div id="jobLists">
    <div class="job-list" data-list="pending"></div>
    <div class="job-list" data-list="inprogress" style="display:none;"></div>
    <div class="job-list" data-list="completed" style="display:none;"></div>
  </div>

  <div class="add-job-container">
    <h2>Add New Job</h2>
    <form id="addJobForm">
      <label for="jobName">Job Name</label>
      <input type="text" id="jobName" required placeholder="Customer or Property Name" />

      <label for="jobDate">Date & Time</label>
      <input type="datetime-local" id="jobDate" required />

      <label for="jobPay">Payment Amount ($)</label>
      <input type="number" id="jobPay" min="0" step="0.01" required />

      <label for="jobWindows">Number of Windows</label>
      <input type="number" id="jobWindows" min="0" required />

      <label for="jobDuration">Estimated Duration (hours)</label>
      <input type="number" id="jobDuration" min="0" step="0.1" required />

      <label for="jobLocation">Location (address or notes)</label>
      <input type="text" id="jobLocation" placeholder="Will update later" />

      <label for="jobStatus">Job Status</label>
      <select id="jobStatus" required>
        <option value="pending">Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
      </select>

      <button type="submit">Add Job</button>
    </form>
  </div>
</main>

<!-- Edit modal -->
<div id="editModal">
  <div class="modal-content">
    <h3>Edit Job</h3>
    <form id="editJobForm">
      <input type="hidden" id="editJobId" />
      <label for="editJobName">Job Name</label>
      <input type="text" id="editJobName" required />

      <label for="editJobDate">Date & Time</label>
      <input type="datetime-local" id="editJobDate" required />

      <label for="editJobPay">Payment Amount ($)</label>
      <input type="number" id="editJobPay" min="0" step="0.01" required />

      <label for="editJobWindows">Number of Windows</label>
      <input type="number" id="editJobWindows" min="0" required />

      <label for="editJobDuration">Estimated Duration (hours)</label>
      <input type="number" id="editJobDuration" min="0" step="0.1" required />

      <label for="editJobLocation">Location (address or notes)</label>
      <input type="text" id="editJobLocation" />

      <label for="editJobStatus">Job Status</label>
      <select id="editJobStatus" required>
        <option value="pending">Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
      </select>

      <button type="submit">Save Changes</button>
      <button type="button" class="close-btn" id="closeEditModal">Cancel</button>
    </form>
  </div>
</div>

<script>
  // Login check & redirect
  const loggedInUser = localStorage.getItem('loggedInUser');
  if(!loggedInUser) {
    if(!window.location.href.includes('login.html')) {
      window.location.href = 'login.html';
    }
  }

  // Logout button
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('loggedInUser');
    window.location.href = 'login.html';
  });

  // Jobs storage key
  const JOBS_STORAGE_KEY = 'hk_window_jobs';

  // Load jobs from localStorage (or empty array)
  function loadJobs() {
    const raw = localStorage.getItem(JOBS_STORAGE_KEY);
    if(!raw) return [];
    try {
      return JSON.parse(raw);
    } catch {
      return [];
    }
  }

  // Save jobs to localStorage
  function saveJobs(jobs) {
    localStorage.setItem(JOBS_STORAGE_KEY, JSON.stringify(jobs));
  }

  // Current jobs data
  let jobs = loadJobs();

  // UI Elements
  const tabs = document.querySelectorAll('.tab-button');
  const jobLists = document.querySelectorAll('.job-list');

  let currentTab = 'pending';

  // Render jobs by tab
  function renderJobs() {
    jobLists.forEach(list => {
      if(list.dataset.list === currentTab) {
        list.style.display = 'block';
      } else {
        list.style.display = 'none';
      }
      // Clear current list
      list.innerHTML = '';
    });

    const filteredJobs = jobs.filter(j => j.status === currentTab);
    if(filteredJobs.length === 0) {
      const emptyMsg = document.createElement('div');
      emptyMsg.textContent = 'No jobs here.';
      emptyMsg.style.padding = '1rem';
      emptyMsg.style.color = '#555';
      document.querySelector(`.job-list[data-list="${currentTab}"]`).appendChild(emptyMsg);
      return;
    }

    filteredJobs.forEach(job => {
      const item = document.createElement('div');
      item.className = 'job-item';
      item.dataset.id = job.id;
      item.innerHTML = `
        <div class="job-title">${job.name}</div>
        <div class="job-info">
          Date & Time: ${new Date(job.date).toLocaleString()}<br>
          Pay: $${parseFloat(job.pay).toFixed(2)}<br>
          Windows: ${job.windows}<br>
          Duration: ${parseFloat(job.duration).toFixed(1)} hr(s)<br>
          Location: ${job.location || '(not set)'}<br>
          Status: ${job.status.charAt(0).toUpperCase() + job.status.slice(1)}
        </div>
      `;
      item.addEventListener('click', () => openEditModal(job.id));
      document.querySelector(`.job-list[data-list="${currentTab}"]`).appendChild(item);
    });
  }

  // Switch tab handler
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentTab = tab.dataset.tab;
      renderJobs();
    });
  });

  // Add job form submission
  document.getElementById('addJobForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('jobName').value.trim();
    const date = document.getElementById('jobDate').value;
    const pay = parseFloat(document.getElementById('jobPay').value);
    const windows = parseInt(document.getElementById('jobWindows').value);
    const duration = parseFloat(document.getElementById('jobDuration').value);
    const location = document.getElementById('jobLocation').value.trim();
    const status = document.getElementById('jobStatus').value;

    if(!name || !date || isNaN(pay) || isNaN(windows) || isNaN(duration)) {
      alert('Please fill out all required fields correctly.');
      return;
    }

    const newJob = {
      id: Date.now().toString(),
      name,
      date,
      pay,
      windows,
      duration,
      location,
      status
    };

    jobs.push(newJob);
    saveJobs(jobs);
    renderJobs();
    e.target.reset();
  });

  // Edit modal elements
  const editModal = document.getElementById('editModal');
  const editJobForm = document.getElementById('editJobForm');

  // Open edit modal with job data
  function openEditModal(jobId) {
    const job = jobs.find(j => j.id === jobId);
    if(!job) return;

    document.getElementById('editJobId').value = job.id;
    document.getElementById('editJobName').value = job.name;
    document.getElementById('editJobDate').value = job.date;
    document.getElementById('editJobPay').value = job.pay;
    document.getElementById('editJobWindows').value = job.windows;
    document.getElementById('editJobDuration').value = job.duration;
    document.getElementById('editJobLocation').value = job.location;
    document.getElementById('editJobStatus').value = job.status;

    editModal.style.display = 'flex';
  }

  // Close edit modal
  document.getElementById('closeEditModal').addEventListener('click', () => {
    editModal.style.display = 'none';
  });

  // Save edited job
  editJobForm.addEventListener('submit', e => {
    e.preventDefault();
    const id = document.getElementById('editJobId').value;
    const name = document.getElementById('editJobName').value.trim();
    const date = document.getElementById('editJobDate').value;
    const pay = parseFloat(document.getElementById('editJobPay').value);
    const windows = parseInt(document.getElementById('editJobWindows').value);
    const duration = parseFloat(document.getElementById('editJobDuration').value);
    const location = document.getElementById('editJobLocation').value.trim();
    const status = document.getElementById('editJobStatus').value;

    if(!name || !date || isNaN(pay) || isNaN(windows) || isNaN(duration)) {
      alert('Please fill out all required fields correctly.');
      return;
    }

    const jobIndex = jobs.findIndex(j => j.id === id);
    if(jobIndex === -1) {
      alert('Job not found');
      return;
    }

    jobs[jobIndex] = {
      id,
      name,
      date,
      pay,
      windows,
      duration,
      location,
      status
    };

    saveJobs(jobs);
    renderJobs();
    editModal.style.display = 'none';
  });

  // Close modal on outside click
  window.addEventListener('click', (e) => {
    if(e.target === editModal) {
      editModal.style.display = 'none';
    }
  });

  // Initial render
  renderJobs();
</script>

</body>
</html>
